<!doctype html>
<html>
<head>
	<title>Functional JS Synth Spike</title>
</head>
<body>
	<header>	
	<h1>Function JS Synth Spike</h1>
	</header>
	<input type="button" value="play" id="play" />
<script>
(function() {

	var context = new webkitAudioContext(),
		calculateSineValue = function (index) {
			return Math.sin(2 * Math.PI * index);
		},
		incrementIndex = function (index, frequency) {
			return index + frequency / context.sampleRate;
		},
		playButton = document.getElementById("play"),
		makeTonePlayer = function () {
			var node = context.createJavaScriptNode(2048, 0, 2),
				index = 0,
				next = function () {
					var returnValue = calculateSineValue(index);
					index = incrementIndex(index, 440);
					return returnValue;
				},
				fillChannelData = function (e) {
					var leftChannel = e.outputBuffer.getChannelData(0),
						rightChannel = e.outputBuffer.getChannelData(1),
						i,
						nextValue;
					for (i = 0; i < leftChannel.length; i = i + 1) {
						nextValue = next();
						leftChannel[i] = nextValue;
						rightChannel[i] = nextValue;
					}
				},
				play = function () {
					node.connect(context.destination);
					return stop;
				},
				stop = function () {
					node.disconnect();
				};

			node.onaudioprocess = fillChannelData;

			return play;
		};

	playButton.addEventListener("click", function() {
		var tonePlayer = makeTonePlayer(),
			stop = tonePlayer();
		setTimeout(stop, 2000);
	});

})();
</script>
</body>
</html>
