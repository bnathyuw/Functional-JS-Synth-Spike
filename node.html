<!doctype html>
<html>
<head>
	<title>Functional JS Synth Spike</title>
</head>
<body>
	<header>	
	<h1>Function JS Synth Spike</h1>
	</header>
	<input type="button" value="play" id="play" />
<script>
(function() {

	var context = new webkitAudioContext(),
		playButton = document.getElementById("play"),
		index = 0,
		next = function () {
			var returnValue = Math.sin(2 * Math.PI * index);
			index = index + 440 / context.sampleRate;
			return returnValue;
		},
		fillChannelData = function (e) {
			var leftChannel = e.outputBuffer.getChannelData(0),
				rightChannel = e.outputBuffer.getChannelData(1),
				i,
				nextValue;
			for (i = 0; i < leftChannel.length; i = i + 1) {
				nextValue = next();
				leftChannel[i] = nextValue;
				rightChannel[i] = nextValue;
			}
		},
		createSineNode = function () {
			var node = context.createJavaScriptNode(2048, 0, 2);
			node.onaudioprocess = fillChannelData;
			return node;
		};

	playButton.addEventListener("click", function() {
		var sineNode = createSineNode();

		sineNode.connect(context.destination);

		setTimeout(function () {
			sineNode.disconnect();
		}, 2000);
	});

})();
</script>
</body>
</html>
